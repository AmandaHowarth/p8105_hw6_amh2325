---
title: "HW6"
author: "Amanda Howarth"
date: "11/23/2019"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(rvest)
library(tidyverse)
library(purrr)
library(broom)
library(modelr)
library(mgcv)
library(patchwork)
```

## Importing data
```{r}
birthweight = read_csv("./data/birthweight.csv")
```
```{r}
birthweight_clean = birthweight %>% 
  janitor::clean_names() %>% 
  mutate(babysex = factor(babysex, levels = c("1", "2")),
         frace = factor(frace, levels = c("1", "2", "3", "4", "8", "9")),
         mrace = factor(mrace, levels = c("1", "2", "3", "4", "8", "9")),
         malform = factor(malform, levels = c("0", "1")),
         babysex = recode(babysex, "1" = "male", "2" = "female"), 
         frace = recode(frace, "1" = "white", "2" = "black", "3" = "asian", "4" = "puerto rican", "8" = "other", "9" = "unknown"),
         mrace = recode(mrace, "1" = "white", "2" = "black", "3" = "asian", "4" = "puerto rican", "8" = "other", "9" = "unknown"), 
         malform = recode(malform, "0" = "absent", "1" = "present")) %>%
  rename(bwt_grams = bwt, mom_weight_lbs = delwt, family_income = fincome, father_race = frace, mom_race = mrace, ges_age_weeks = gaweeks, age_menarche = menarche, mom_height = mheight, mom_age = momage, mom_pre_bmi = ppbmi)
```

## Model building
I have hypothesized that a baby's physical and biological characteristics as well as the mother's physical and biological characteristics at the time of delivery would affect the baby's weight at birth. Thus, in building my model I analyzed baby's sex, head circumference, baby length, gestational age, and presence of malformations that would affect weight. Additionally, I analyzed mother's weight, age at delivery, and height. 

* say that u removed some bc it did not increase in the R^2 
* say looked at all of them first and then chose significant ones 
* say teh R^2 value 
* reisduals ? predictions? 
* removed malform bc not significant 

```{r}
fit_bwt_model = lm(bwt_grams ~ babysex + bhead + blength + mom_weight_lbs + ges_age_weeks, data = birthweight_clean)

fit_bwt_model %>% 
  broom::tidy() %>% 
  knitr::kable()

fit_bwt_model %>%
  broom::glance() %>% 
  knitr::kable()
```

Show a plot of model residuals against fitted values â€“ use add_predictions and add_residuals in making this plot.
```{r}
birthweight_clean %>% 
  modelr::add_residuals(fit_bwt_model) %>% 
  modelr::add_predictions(fit_bwt_model) %>% 
  ggplot(aes(x = pred, y = resid)) + geom_point() + labs(
    y = "Residuals", 
    x = "Predicted values of Birthweight", 
    title = "Residuals Plotted Against Birthweight"
    
  )
```

## Model using using length at birth and gestational age as predictors (main effects only)

```{r}
sample_model_1 = lm(bwt_grams ~  blength + ges_age_weeks, data = birthweight_clean)

sample_model_1 %>% 
  broom::tidy() %>% 
  knitr::kable()

sample_model_1 %>% 
  broom::glance() %>% 
  knitr::kable()
```

## Model using head circumference, length, sex, and all interactions (including the three-way interaction) between these

```{r}
sample_model_2 = lm(bwt_grams ~ bhead + blength + babysex + bhead*blength + bhead*babysex + babysex*blength + bhead*blength*babysex, data = birthweight_clean)

sample_model_2 %>% 
  broom::tidy() %>% 
  knitr::kable()

sample_model_2 %>% 
  broom::glance() %>% 
  knitr::kable()
```

## Cross Validation 

```{r}
rmse(fit_bwt_model, birthweight_clean)
rmse(sample_model_1, birthweight_clean)
rmse(sample_model_2, birthweight_clean)

cv_df = 
  crossv_mc(birthweight_clean, 100) 
```

```{r}


```